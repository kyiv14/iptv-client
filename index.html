<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–ª—É—á–∏—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --system-blue: #007AFF;
            --system-gray-light: #F2F2F7;
            --system-green: #34C759;
            --system-red: #FF3B30;
        }

        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –∏ —Ñ–æ–Ω */
        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            color: #333;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ñ–æ—Ä–º—ã */
        .form-container {
            background: #ffffff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            max-width: 450px;
            width: 100%;
            animation: fadeInScale 0.6s ease-out;
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.95); }
            to { transform: scale(1); opacity: 1; }
        }

        h1 {
            color: #444;
            margin-bottom: 35px;
            font-weight: 600;
            text-align: center;
            font-size: 24px;
        }

        /* –ì—Ä—É–ø–ø–∞ –¥–ª—è –≤–≤–æ–¥–∞ */
        .input-group-modern {
            position: relative;
            margin-bottom: 35px;
        }

        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
        .input-group-modern input {
            width: 100%;
            padding: 15px 10px 5px 10px;
            background: none;
            border: none;
            border-bottom: 2px solid #ccc;
            font-size: 16px;
            color: #333;
            outline: none;
            transition: border-bottom-color 0.3s ease;
        }

        .input-group-modern input:focus,
        .input-group-modern input:not(:placeholder-shown) {
            border-bottom-color: var(--system-blue);
        }

        /* –ü–ª–∞–≤–∞—é—â–∞—è –º–µ—Ç–∫–∞ (label) */
        .input-group-modern label {
            position: absolute;
            top: 15px;
            left: 10px;
            color: #999;
            font-size: 16px;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .input-group-modern input:focus + label,
        .input-group-modern input:not(:placeholder-shown) + label {
            top: -10px;
            left: 0;
            font-size: 12px;
            color: var(--system-blue);
        }

        /* –ö–Ω–æ–ø–∫–∞ */
        .submit-btn-modern {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            background: var(--system-blue); 
            color: white;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.4);
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        .submit-btn-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.6);
        }

        .submit-btn-modern:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(0, 123, 255, 0.4);
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
            padding: 20px 0;
        }
        
        .modal-content {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 14px;
            padding: 25px;
            animation: modalOpen 0.3s ease-out;
        }
        
        @keyframes modalOpen {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            font-size: 20px;
            color: var(--system-blue);
            margin: 0;
        }

        .close-btn {
            font-size: 28px;
            cursor: pointer;
            line-height: 1;
        }

        .link-result-link {
            background: var(--system-gray-light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            word-break: break-all;
            text-align: center;
            font-size: 16px;
            font-weight: 500;
        }
        
        .link-result-actions {
            display: flex;
            gap: 12px;
        }
        
        .link-result-actions button {
            flex: 1;
            font-size: 16px;
            padding: 12px;
            border-radius: 8px;
        }

        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-size: 15px;
            display: none;
        }
        
        .status-message.success {
            background-color: #e6ffe6;
            color: var(--system-green);
        }
        
        .status-message.error {
            background-color: #ffe6e6;
            color: var(--system-red);
        }
    </style>
</head>
<body>

    <div class="form-container">
        <form class="modern-form" onsubmit="return false;">
            <h1>–ü–æ–ª—É—á–∏—Ç–µ –≤–∞—à –ø–ª–µ–π–ª–∏—Å—Ç! üé∂</h1>

            <div class="input-group-modern">
                <input type="text" id="clientName" required placeholder=" ">
                <label for="clientName">–í–∞—à–µ –∏–º—è</label>
            </div>

            <div class="input-group-modern">
                <input type="text" id="clientPhone" required placeholder=" ">
                <label for="clientPhone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Å–≤–æ–±–æ–¥–Ω—ã–π –≤–≤–æ–¥)</label>
            </div>

            <button type="submit" class="submit-btn-modern" id="getPlaylistBtn">
                –ü–æ–ª—É—á–∏—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç
            </button>
            <div id="playlistStatus" class="status-message"></div>
        </form>
    </div>

    <div id="linkDisplayModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–ª–µ–π–ª–∏—Å—Ç</h2>
                <span class="close-btn" onclick="closeModal('linkDisplayModal')">√ó</span>
            </div>
            
            <div class="link-result-content">
                <h3>–í–∞—à–∞ –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞:</h3>
                <div class="link-result-link" id="finalPlaylistLink">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
            
            <div class="link-result-actions">
                <button id="copyLinkBtn" style="background: var(--system-blue);" class="secondary">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
                <button id="downloadLinkBtn" style="background: #ccc; color: #333;">–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª</button>
            </div>
        </div>
    </div>

    <script>
        // =================================================================
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø (–í–∑—è—Ç–æ –∏–∑ index (1).html)
        // =================================================================
        
        // –†–ï–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï –ò–ó –í–ê–®–ï–ì–û –§–ê–ô–õ–ê index (1).html
        const TOKEN_PARTS = ["ghp_to27A4", "Q0SrXyfBANG1", "fxQvzyhhgwrn0rm1ra"];
        const REPO_CONFIG = {
            owner: "kyiv14",
            repo: "moe-iptv",
            branch: "main",
            clientsFile: "public/clients.json",
            // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–π –ø—É—Ç—å –∫ sample.m3u –Ω–∞ Vercel
            samplePlaylist: "https://moe-iptv.vercel.app/sample.m3u", 
            // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–π –±–∞–∑–æ–≤—ã–π URL –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫
            baseUrl: "https://moe-iptv.vercel.app/"
        };
        
        // –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        let clients = []; 
        
        function getGitHubToken() {
            return TOKEN_PARTS.join('');
        }

        // =================================================================
        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ index (1).html)
        // =================================================================

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 —Ü–∏—Ñ—Ä –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–Ω—É–∂–Ω–∞ –¥–ª—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞)
        function extractPhoneNumber(phone) {
            const digits = phone.replace(/\D/g, '');
            // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ü–∏—Ñ—Ä, –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–µ
            return digits.slice(-10);
        }

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showStatus(message, type, elementId = 'playlistStatus') {
            const statusEl = document.getElementById(elementId);
            statusEl.innerHTML = message;
            statusEl.className = 'status-message ' + type;
            statusEl.style.display = 'block';
        }

        function copyToClipboard(text, event) {
            event.preventDefault();
            navigator.clipboard.writeText(text).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
            });
            alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
            return false;
        }
        
        function forceDownload(url, filename) {
            fetch(url)
                .then(response => response.blob())
                .then(blob => {
                    const blobUrl = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = blobUrl;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    setTimeout(() => {
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(blobUrl);
                    }, 100);
                })
                .catch(error => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞:', error));
        }


        // =================================================================
        // –õ–û–ì–ò–ö–ê GITHUB/API (–ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ index (1).html)
        // =================================================================

        async function getFileSha(filename) {
            try {
                const apiUrl = `https://api.github.com/repos/${REPO_CONFIG.owner}/${REPO_CONFIG.repo}/contents/${filename}`;
                const response = await fetch(apiUrl, {
                    headers: {
                        'Authorization': `Bearer ${getGitHubToken()}`,
                        'Accept': 'application/vnd.github+json'
                    }
                });
                if (response.ok) {
                    const data = await response.json();
                    return data.sha;
                }
                return null;
            } catch (error) {
                return null;
            }
        }

        async function createIsGdShortUrl(phone) {
            try {
                const cleanPhone = extractPhoneNumber(phone);
                const longUrl = `${REPO_CONFIG.baseUrl}${cleanPhone}.m3u`;
                
                const apiUrl = `https://is.gd/create.php?format=json&url=${encodeURIComponent(longUrl)}&shorturl=${cleanPhone}`;
                const response = await fetch(apiUrl);
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const data = await response.json();
                
                if (data.errorcode) return `https://is.gd/${cleanPhone}`;
                
                return data.shorturl;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è is.gd —Å—Å—ã–ª–∫–∏:', error);
                return `https://is.gd/${extractPhoneNumber(phone)}`;
            }
        }

        // –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: –°–æ–∑–¥–∞–µ—Ç –ø–ª–µ–π–ª–∏—Å—Ç –Ω–∞ GitHub
        async function createPlaylist(phone, key) {
            const cleanPhone = extractPhoneNumber(phone);
            if (cleanPhone.length < 10) throw new Error("–ù–æ–º–µ—Ä –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 10 —Ü–∏—Ñ—Ä (–≤–∫–ª—é—á–∞—è –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã/–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞)");
            const filename = `public/${cleanPhone}.m3u`;
            
            // 1. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–ª–µ–π–ª–∏—Å—Ç–∞
            const response = await fetch(REPO_CONFIG.samplePlaylist);
            let content = await response.text();
            content = content.replace(/\/iptv\/\w+\//g, `/iptv/${key}/`);
            
            const sha = await getFileSha(filename);
            
            // 2. –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–∞ –Ω–∞ GitHub
            const apiUrl = `https://api.github.com/repos/${REPO_CONFIG.owner}/${REPO_CONFIG.repo}/contents/${filename}`;
            const uploadResponse = await fetch(apiUrl, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${getGitHubToken()}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/vnd.github+json'
                },
                body: JSON.stringify({
                    message: `–î–æ–±–∞–≤–ª–µ–Ω –ø–ª–µ–π–ª–∏—Å—Ç: ${cleanPhone}`,
                    content: btoa(unescape(encodeURIComponent(content))),
                    branch: REPO_CONFIG.branch,
                    sha: sha
                })
            });
            
            if (!uploadResponse.ok) {
                const error = await uploadResponse.json();
                throw new Error(error.message || "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞ GitHub");
            }

            // 3. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏ is.gd
            const isgdUrl = await createIsGdShortUrl(phone);

            // 4. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            return {
                isgdUrl: isgdUrl,
                m3uFilename: filename.split('/').pop(),
                m3uContent: content
            };
        }

        // –§–£–ù–ö–¶–ò–Ø: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –≤ clients.json
        async function saveClientData(client) {
            // 1. –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
            const loadClients = async () => {
                const apiUrl = `https://api.github.com/repos/${REPO_CONFIG.owner}/${REPO_CONFIG.repo}/contents/${REPO_CONFIG.clientsFile}`;
                const response = await fetch(apiUrl, {
                    headers: {
                        'Authorization': `Bearer ${getGitHubToken()}`,
                        'Accept': 'application/vnd.github+json'
                    }
                });
                if (response.ok) {
                    const data = await response.json();
                    const content = decodeURIComponent(escape(atob(data.content)));
                    return { clients: JSON.parse(content) || [], sha: data.sha };
                }
                // –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (404)
                return { clients: [], sha: null };
            };

            let { clients: currentClients, sha } = await loadClients();
            
            // 2. –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –æ–Ω –Ω–æ–≤—ã–π)
            currentClients.push(client);

            // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
            const apiUrl = `https://api.github.com/repos/${REPO_CONFIG.owner}/${REPO_CONFIG.repo}/contents/${REPO_CONFIG.clientsFile}`;
            const response = await fetch(apiUrl, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${getGitHubToken()}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/vnd.github+json'
                },
                body: JSON.stringify({
                    message: `–î–æ–±–∞–≤–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç –∏–∑ –≤–Ω–µ—à–Ω–µ–π —Ñ–æ—Ä–º—ã: ${client.name}`,
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(currentClients)))),
                    branch: REPO_CONFIG.branch,
                    sha: sha 
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞.");
            }
            return true;
        }


        // =================================================================
        // –ì–õ–ê–í–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –§–û–†–ú–´
        // =================================================================

        document.addEventListener('DOMContentLoaded', () => {
            const phoneInput = document.getElementById('clientPhone');
            const nameInput = document.getElementById('clientName');
            const getPlaylistBtn = document.getElementById('getPlaylistBtn');

            // 1. –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–∞—Å–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            // 2. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü–æ–ª—É—á–∏—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç"
            getPlaylistBtn.addEventListener('click', async () => {
                const name = nameInput.value.trim();
                const phone = phoneInput.value.trim();
                const cleanPhoneDigits = extractPhoneNumber(phone); // –ü–æ–ª—É—á–∞–µ–º —á–∏—Å—Ç—ã–µ —Ü–∏—Ñ—Ä—ã

                // –í–∞–ª–∏–¥–∞—Ü–∏—è
                if (!name || !phone) {
                    showStatus("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è", "error");
                    return;
                }
                if (cleanPhoneDigits.length < 10) {
                    showStatus("–ù–æ–º–µ—Ä –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ –º–µ–Ω–µ–µ 10 —Ü–∏—Ñ—Ä (–≤–∫–ª—é—á–∞—è –∫–æ–¥)", "error");
                    return;
                }

                // showStatus("–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞...", "success"); <--- –≠–¢–ê –°–¢–†–û–ö–ê –£–î–ê–õ–ï–ù–ê

                // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
                const defaultKey = '0000000000'; 
                const defaultMonths = '1';
                const defaultPaymentDate = new Date().toISOString().split('T')[0];

                try {
                    // –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞ (.m3u) –Ω–∞ GitHub
                    const result = await createPlaylist(phone, defaultKey);

                    // –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                    const newClient = {
                        name: name,
                        phone: cleanPhoneDigits, // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ —á–∏—Å—Ç—ã–µ —Ü–∏—Ñ—Ä—ã
                        key: defaultKey,
                        paymentDate: defaultPaymentDate,
                        months: defaultMonths
                    };

                    // –®–∞–≥ 3: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤ clients.json –Ω–∞ GitHub
                    await saveClientData(newClient);

                    // showStatus("–ü–ª–µ–π–ª–∏—Å—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –∏ –∫–ª–∏–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω!", "success"); <--- –≠–¢–ê –°–¢–†–û–ö–ê –£–î–ê–õ–ï–ù–ê

                    // –®–∞–≥ 4: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å–æ —Å—Å—ã–ª–∫–æ–π
                    document.getElementById('finalPlaylistLink').textContent = result.isgdUrl;

                    // –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Å—ã–ª–∫–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                    const tempUrl = URL.createObjectURL(new Blob([result.m3uContent], { type: 'application/x-mpegurl' }));
                    
                    document.getElementById('copyLinkBtn').onclick = (e) => copyToClipboard(result.isgdUrl, e);
                    document.getElementById('downloadLinkBtn').onclick = () => {
                        forceDownload(tempUrl, result.m3uFilename);
                        alert('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –Ω–∞—á–∞–ª–∞—Å—å!');
                    };
                    
                    openModal('linkDisplayModal');
                    
                    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
                    nameInput.value = '';
                    phoneInput.value = '';
                    
                } catch (error) {
                    showStatus(`–û—à–∏–±–∫–∞: ${error.message}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –∏ –¥–æ—Å—Ç—É–ø.`, "error");
                    console.error('–û—Å–Ω–æ–≤–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
                }
            });
        });

        window.copyToClipboard = copyToClipboard;
        window.forceDownload = forceDownload;
    </script>
</body>
</html>