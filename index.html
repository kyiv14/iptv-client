<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Доступное IPTV | Вход и Регистрация</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --system-blue: #007AFF;
            --system-gray-light: #F2F2F7;
            --system-green: #34C759;
            --system-red: #FF3B30;
            --blue-hover: #0056b3;
            --green-hover: #218838;
            --qr-color: #333;
        }

        /* Общие стили и фон */
        body {
            font-family: 'Montserrat', sans-serif;
            background: #FFFFFF;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            color: #333;
            flex-direction: column;
            position: relative;
        }
        
        /* АНИМАЦИЯ ПОЯВЛЕНИЙ ЭЛЕМЕНТОВ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* АНИМАЦИЯ ПОЯВЛЕНИЯ БЛОКОВ ПОСЛЕ АВТОРИЗАЦИИ */
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        /* КОНТЕЙНЕР ОСНОВНОГО КОНТЕНТА (НАСТОЛЬНЫЙ) */
        .main-content {
            max-width: 700px;
            text-align: center;
            padding: 20px;
            margin-top: 50px; 
            margin-bottom: 50px; 
            opacity: 0;
            animation: fadeIn 0.8s ease-out forwards;
            animation-delay: 0.2s;
        }

        .main-content h1 {
            font-size: 38px;
            color: var(--system-blue);
            margin-bottom: 20px;
            font-weight: 700;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .main-content p {
            font-size: 18px;
            color: #555;
            line-height: 1.6;
            /* Уменьшаем нижний отступ, так как сразу за ним идет кнопка */
            margin-bottom: 20px; 
        }
        
        /* =================================================== */
        /* СТИЛИ БЛОКА "КАК ПОДКЛЮЧИТЬ IPTV" */
        /* =================================================== */
        .how-to-connect-block {
            max-width: 1000px;
            width: 100%;
            padding: 30px 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            opacity: 0;
            animation: fadeIn 0.8s ease-out forwards;
            animation-delay: 0.5s;
            margin-bottom: 40px; 
        }

        .how-to-connect-block h2 {
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 40px;
            color: #333;
        }

        .steps-container {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            flex-wrap: wrap;
        }

        .step-item {
            flex-basis: 200px; 
            text-align: center;
            padding: 10px;
            transition: transform 0.3s ease;
        }
        
        .step-item:hover {
            transform: translateY(-5px);
        }

        .step-number {
            width: 40px;
            height: 40px;
            line-height: 40px;
            background: var(--system-blue); 
            color: white;
            border-radius: 50%;
            font-size: 20px;
            font-weight: 900;
            margin: 0 auto 15px;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.4);
            transition: transform 0.3s ease;
        }
        
        .step-item:hover .step-number {
            transform: scale(1.1);
        }

        .step-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--system-blue);
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .step-description {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
            line-height: 1.4;
        }

        .step-description a {
             color: var(--system-blue);
             text-decoration: none;
             font-weight: 600;
             transition: color 0.2s ease;
        }
        
        .step-description a:hover {
             color: var(--blue-hover);
             text-decoration: underline;
        }

        /* =================================================== */
        /* СТИЛИ БЛОКА "ГДЕ РАБОТАЕТ IPTV?" */
        /* =================================================== */
        .where-it-works-block {
            max-width: 1000px;
            width: 100%;
            padding: 30px 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            opacity: 0;
            animation: fadeIn 0.8s ease-out forwards;
            animation-delay: 0.8s;
            margin-bottom: 40px;
        }

        .where-it-works-block h2 {
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 40px;
            color: #333;
        }

        .devices-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px 20px;
            justify-items: center;
            padding: 0 5%;
        }

        .device-item {
            text-align: center;
            padding: 10px;
            transition: transform 0.3s ease;
        }
        
        .device-item:hover {
            transform: translateY(-5px);
        }

        .device-icon {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--system-blue); 
            margin: 0 auto 10px;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.4);
        }
        
        .device-icon img {
            width: 70%;
            height: 70%;
            object-fit: contain;
        }

        .device-name {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            text-transform: uppercase;
            margin-top: 5px;
        }
        
        /* =================================================== */
        /* СТИЛИ БЛОКА ПЛЕЙЛИСТА (ПОСЛЕ АВТОРИЗАЦИИ) */
        /* =================================================== */
        .post-auth-layout {
            display: none; /* ИЗМЕНЕНИЕ: Скрыт по умолчанию, показывается JS */
            justify-content: center;
            max-width: 1200px;
            width: 100%;
            gap: 30px;
            margin-top: 50px;
            margin-bottom: 50px;
            
            /* НОВАЯ АНИМАЦИЯ для контейнера */
            animation: fadeInScale 0.6s ease-out forwards;
        }

        .playlist-info-page,
        .payment-block {
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            flex: 1; 
            min-width: 300px;
            text-align: center;
        }
        
        /* Убираем display:none из JS для внутренних блоков, но сохраняем для родителя */
        .playlist-info-page {
            display: block; 
        }
        .payment-block {
            display: block; 
        }
        
        /* Стили для заголовков и информации о клиенте */
        .client-greeting {
            color: var(--system-blue);
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .playlist-info-page h2 {
            color: #333;
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 25px;
        }

        .expiration-info {
            font-size: 18px;
            font-weight: 600;
            color: var(--system-red);
            margin-bottom: 25px;
        }

        .playlist-link-box {
            background: var(--system-gray-light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
            word-break: break-all;
            font-size: 16px;
            font-weight: 500;
        }
        
        /* ИЗМЕНЕНИЕ: Ограничение и центрирование контейнера кнопок плейлиста */
        .playlist-info-actions {
            display: flex;
            gap: 12px;
            flex-direction: column;
            width: 100%;
            max-width: 300px; 
            margin: 0 auto; /* Центрируем */
        }

        .playlist-info-actions button {
            width: 100%;
            font-size: 20px; 
            padding: 15px;
            border-radius: 8px;
            color: white; 
            font-weight: 700;
            border: none;
            outline: none;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        /* АНИМАЦИЯ КНОПОК ПЛЕЙЛИСТА (Копировать/Скачать) */
        .playlist-info-actions button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        
        .playlist-info-actions button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        /* Отдельные стили для hover, чтобы сохранить цвета */
        #copyLinkBtnPage:hover {
            background: var(--blue-hover) !important;
        }
        
        #downloadLinkBtnPage:hover {
            background: var(--green-hover) !important;
        }

        /* СТИЛИ БЛОКА ОПЛАТЫ */
        .payment-block h2 {
            color: var(--system-green);
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        /* Стили для блока с номером карты */
        .card-number-display {
            background: var(--system-gray-light);
            padding: 15px;
            border-radius: 8px;
            margin: 0 auto 20px;
            font-size: 22px;
            font-weight: 700;
            color: #333;
            max-width: 300px;
            overflow-wrap: break-word; 
        }


        .payment-amount {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
        }

        /* ИЗМЕНЕНИЕ: Ограничение и центрирование кнопки оплаты */
        .submit-btn-modern {
            width: 100%;
            max-width: 300px; /* Ограничение ширины */
            margin: 0 auto; /* Центрирование */
            padding: 15px; /* Сохраняем паддинг для высоты */
            border: none;
            border-radius: 8px;
            background: var(--system-blue); 
            color: white;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.4);
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
            z-index: 1;
            display: block; /* Важно для центрирования с margin: auto */
        }

        .payment-btn {
            background: var(--system-green) !important;
            box-shadow: 0 4px 15px rgba(52, 199, 89, 0.4) !important;
            margin-top: 10px; 
        }
        
        .payment-btn:hover {
            background: var(--green-hover) !important;
            box-shadow: 0 8px 25px rgba(52, 199, 89, 0.6) !important;
        }
        
        /* СТИЛЬ КНОПКИ КОПИРОВАНИЯ КАРТЫ */
        .copy-card-btn {
            background: var(--system-blue);
            color: white;
            font-weight: 700;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.1s ease;
            font-size: 16px;
            width: 100%; 
            max-width: 300px;
            margin: 0 auto; 
            display: block; 
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.4); 
        }
        
        .copy-card-btn:hover {
            background: var(--blue-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 123, 255, 0.5);
        }
        
        .copy-card-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 123, 255, 0.4);
        }


        /* =================================================== */
        /* АДАПТИВНОСТЬ */
        /* =================================================== */
        
        @media (max-width: 900px) {
            .post-auth-layout {
                flex-direction: column; /* Вертикальный стек на планшетах/мобильных */
                gap: 40px;
            }
        }

        @media (max-width: 768px) {
            .devices-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 500px) {
            .devices-container {
                grid-template-columns: 1fr;
            }
            .main-content {
                margin-top: 80px;
            }
            .main-content h1 {
                font-size: 32px;
                line-height: 1.2;
            }
            .main-content p {
                font-size: 18px;
            }
            .how-to-connect-block h2,
            .where-it-works-block h2 {
                font-size: 24px;
            }
            .step-title,
            .device-name {
                font-size: 16px;
            }
            .step-description {
                font-size: 15px;
            }
            .steps-container {
                gap: 30px;
            }
            .step-item {
                flex-basis: 90%;
            }
            .auth-buttons-container {
                top: 10px;
                right: 10px;
            }
            .client-greeting {
                font-size: 24px;
            }
            .playlist-info-page h2 {
                font-size: 18px;
            }
            /* Уменьшаем размер текста номера карты на мобильных */
            .card-number-display {
                font-size: 20px;
            }
            
            /* Снимаем ограничение ширины для .playlist-info-actions на очень маленьких экранах, чтобы они заполняли контейнер, если нужно */
            .playlist-info-actions,
            .copy-card-btn,
            .submit-btn-modern {
                max-width: 90%; 
            }
            
            /* Убираем ограничение в модальном окне на узких экранах, чтобы не было слишком узко */
            #loginModal .input-group-modern {
                max-width: none;
            }
        }

        /* =================================================== */
        /* КНОПКИ НАВИГАЦИИ */
        /* =================================================== */
        
        /* СТИЛЬ КНОПКИ СПИСКА КАНАЛОВ (внутри .main-content) */
        .channel-list-btn {
            display: inline-block; /* Для центрирования в блоке */
            margin-top: 10px;
            margin-bottom: 30px;
            padding: 12px 24px;
            background: var(--system-blue);
            color: white;
            font-weight: 700;
            border-radius: 8px;
            text-decoration: none;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.4);
            transition: all 0.3s ease;
        }

        .channel-list-btn:hover {
            background: var(--blue-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 123, 255, 0.5);
        }

        /* КОНТЕЙНЕР ДЛЯ ПРАВЫХ КНОПОК (СУЩЕСТВУЮЩИЙ) */
        .auth-buttons-container {
            position: fixed; 
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 110;
        }
        
        /* Стили для всех навигационных кнопок в правом углу */
        .auth-btn {
            padding: 12px 18px;
            border: none;
            border-radius: 8px;
            background: var(--system-blue);
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease, opacity 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.4);
            display: block; 
            opacity: 1;
        }

        .auth-btn:hover {
            background: var(--blue-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 123, 255, 0.5);
        }
        
        .auth-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 123, 255, 0.4);
        }

        .auth-btn-payment {
            background-color: var(--system-green) !important;
            box-shadow: 0 4px 10px rgba(52, 199, 89, 0.4) !important;
        }
        .auth-btn-payment:hover {
            background-color: var(--green-hover) !important;
            box-shadow: 0 6px 15px rgba(52, 199, 89, 0.5) !important;
        }
        
        /* СТИЛИ КНОПКИ ВЫХОДА (Красная) */
        #logoutBtn {
             background-color: var(--system-red) !important;
             box-shadow: 0 4px 10px rgba(255, 59, 48, 0.4) !important;
             transition: opacity 0.3s ease, background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
             display: none; 
             opacity: 0;
        }
        #logoutBtn:hover {
             background-color: #cc0000 !important;
             box-shadow: 0 6px 15px rgba(255, 59, 48, 0.5) !important;
        }

        /* Стили для модальных окон */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
            padding: 20px 0;
            overflow-y: auto;
        }
        
        .modal-content {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 14px;
            padding: 25px;
            animation: modalOpen 0.3s ease-out;
            position: relative;
        }
        
        @keyframes modalOpen {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* НОВЫЕ СТИЛИ ДЛЯ КНОПКИ ЗАКРЫТИЯ (КРЕСТИК) */
        .close-btn {
            position: absolute;
            top: -15px; /* Выносим крестик за пределы блока */
            right: -15px;
            width: 35px;
            height: 35px;
            line-height: 35px;
            text-align: center;
            font-size: 28px; /* Увеличиваем размер крестика */
            color: white; /* Делаем крестик белым */
            background: var(--system-blue); /* Синий круг */
            border-radius: 50%;
            cursor: pointer;
            opacity: 0.9;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease, opacity 0.2s ease, background 0.2s ease;
            font-weight: 300; /* Делаем крестик тоньше */
            z-index: 10;
        }
        
        .close-btn:hover {
            opacity: 1;
            transform: scale(1.1); /* Анимация при наведении */
            background: var(--system-red); /* Меняем цвет при наведении */
        }
        /* /КОНЕЦ НОВЫХ СТИЛЕЙ КРЕСТИКА */

        /* INPUTS AND STATUS MESSAGES */
        .input-group-modern {
            position: relative;
            margin-bottom: 35px;
        }
        .input-group-modern input {
            width: 100%;
            padding: 15px 10px 5px 10px;
            background: none;
            border: none;
            border-bottom: 2px solid #ccc;
            font-size: 16px;
            color: #333;
            outline: none;
            transition: border-bottom-color 0.3s ease;
        }
        .input-group-modern input:focus,
        .input-group-modern input:not(:placeholder-shown) {
            border-bottom-color: var(--system-blue);
        }
        .input-group-modern label {
            position: absolute;
            top: 15px;
            left: 10px;
            color: #999;
            font-size: 16px;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        .input-group-modern input:focus + label,
        .input-group-modern input:not(:placeholder-shown) + label {
            top: -10px;
            left: 0;
            font-size: 12px;
            color: var(--system-blue);
        }
        
        /* ИЗМЕНЕНИЕ: Уменьшение ширины линий в модальном окне ВХОДА */
        #loginModal .input-group-modern {
            max-width: 66.6%; 
            margin: 0 auto 35px; 
        }

        /* Общие стили для кнопки submit-btn-modern */
        .submit-btn-modern:not(#loginBtn) { /* Применяем к кнопке регистрации */
            width: 100%;
            max-width: 300px; 
            margin: 0 auto; 
            display: block;
        }

        /* Специальные стили для кнопки ВХОДА */
        #loginBtn {
            width: 100%;
            max-width: 66.6%; /* Та же ширина, что и для полей ввода */
            margin: 0 auto;
            display: block; /* Центрирование */
        }
        
        .submit-btn-modern {
            padding: 15px;
            border: none;
            border-radius: 8px;
            background: var(--system-blue); 
            color: white;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.4);
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }
        .submit-btn-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.6);
        }
        .submit-btn-modern:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(0, 123, 255, 0.4);
        }
        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-size: 15px;
            display: none;
        }
        .status-message.success {
            background-color: #e6ffe6;
            color: var(--system-green);
        }
        .status-message.error {
            background-color: #ffe6e6;
            color: var(--system-red);
        }

    </style>
</head>
<body>
    
    <div class="auth-buttons-container" id="authButtonsContainer">
        <button class="auth-btn auth-btn-payment" id="paymentBtnNav" onclick="alert('Переход на страницу оплаты. Настройте ссылку!')">Оплата</button>
        <button class="auth-btn" id="regBtn" onclick="openModal('registrationModal')">Регистрация</button>
        <button class="auth-btn" id="loginBtnNav" onclick="openModal('loginModal')">Вход</button>
        <button class="auth-btn" id="logoutBtn" onclick="logout()">Выход</button>
    </div>

    <div class="main-content" id="preAuthContent">
        <h1>Доступное IPTV — 4000 каналов IPTV в отличном качестве с архивом.</h1>
        <p>Современный сервис IPTV телевидения, который дает возможность смотреть каналы в Full HD и Ultra HD качестве. Плейлист IPTV телевидения насчитывает 4000 IPTV каналов. Присоединяйтесь к нам и желаем Вам приятного просмотра</p>
        
        <a href="https://iptv-spisok.vercel.app/" target="_blank" class="channel-list-btn">Список каналов</a>
    </div>

    <div class="how-to-connect-block" id="howToConnectBlock">
        <h2>Как подключить IPTV</h2>
        <div class="steps-container">
            <div class="step-item">
                <div class="step-number">1</div>
                <div class="step-title">Регистрация</div>
                <div class="step-description">
                    Нажмите кнопку Регистрация в правом верхнем углу
                </div>
            </div>
            <div class="step-item">
                <div class="step-number">2</div>
                <div class="step-title">Оплата</div>
                <div class="step-description">Оплатить подписку</div>
            </div>
            <div class="step-item">
                <div class="step-number">3</div>
                <div class="step-title">Плейлист</div>
                <div class="step-description">Скачать плейлист</div>
            </div>
            <div class="step-item">
                <div class="step-number">4</div>
                <div class="step-title">Загрузка</div>
                <div class="step-description">Загрузить плейлист в Ваше устройство</div>
            </div>
        </div>
    </div>
    
    <div class="where-it-works-block" id="whereItWorksBlock">
        <h2>Где работает IPTV?</h2>
        <div class="devices-container">
            <div class="device-item">
                <div class="device-icon">
                    <img src="https://iptvclient.vercel.app/smartphone-call.png" alt="Смартфон">
                </div>
                <div class="device-name">На смартфоне</div>
            </div>
            <div class="device-item">
                <div class="device-icon">
                    <img src="https://iptvclient.vercel.app/computer-tablet.png" alt="Планшет">
                </div>
                <div class="device-name">На планшете</div>
            </div>
            <div class="device-item">
                <div class="device-icon">
                    <img src="https://iptvclient.vercel.app/tv-box.png" alt="ТВ приставка">
                </div>
                <div class="device-name">На ТВ приставке</div>
            </div>
            
            <div class="device-item">
                <div class="device-icon">
                    <img src="https://iptvclient.vercel.app/tv.png" alt="Smart TV">
                </div>
                <div class="device-name">На Smart TV телевизоре</div>
            </div>
            <div class="device-item">
                <div class="device-icon">
                    <img src="https://iptvclient.vercel.app/tv-tuner.png" alt="Спутниковый тюнер">
                </div>
                <div class="device-name">На спутниковом тюнере</div>
            </div>
            <div class="device-item">
                <div class="device-icon">
                    <img src="https://iptvclient.vercel.app/laptop.png" alt="Компьютер">
                </div>
                <div class="device-name">На компьютере и ноутбуке</div>
            </div>
        </div>
    </div>


    <div class="post-auth-layout">
        <div id="playlistInfoPage" class="playlist-info-page">
            <p class="client-greeting" id="clientNameGreeting"></p>
            <h2 style="font-weight: 600;">Ваш плейлист</h2> 

            <p class="expiration-info" id="expirationMessage"></p>
            <p style="color: #666; margin-bottom: 25px;">Используйте ссылку ниже для подключения к IPTV-сервису на вашем устройстве.</p>
            
            <div class="playlist-link-box" id="finalPlaylistLink">Загрузка...</div>
            
            <div class="playlist-info-actions">
                <button id="copyLinkBtnPage" style="background: var(--system-blue);">Копировать ссылку</button>
                <button id="downloadLinkBtnPage" style="background: var(--system-green);">Скачать файл</button>
            </div>
        </div>

        <div id="paymentBlock" class="payment-block playlist-info-page">
            <h2>Оплата подписки</h2>
            <p class="payment-amount">Оплатить 150 грн</p>
            
            <div class="card-number-display" id="cardNumberDisplay">
                5168752084846610
            </div>
            
            <button class="copy-card-btn" onclick="copyToClipboard('5168752084846610', event)">
                Копировать номер
            </button>
            
            <p style="color: #666; margin-top: 20px; margin-bottom: 25px; font-size: 14px;">
                Скопируйте номер карты, чтобы оплатить подписку.
            </p>

            <button class="submit-btn-modern payment-btn" onclick="alert('Переход к платежной системе!')">
                Перейти к оплате
            </button>
        </div>
    </div>


    <div id="registrationModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('registrationModal')">&times;</span>
            <h1>Регистрация</h1>

            <form id="registrationForm" onsubmit="return false;">
                <div class="input-group-modern">
                    <input type="text" id="clientName" required placeholder=" ">
                    <label for="clientName">Ваше имя</label>
                </div>

                <div class="input-group-modern">
                    <input type="tel" id="clientPhone" required placeholder=" ">
                    <label for="clientPhone">Номер телефона</label>
                </div>

                <div class="input-group-modern">
                    <input type="password" id="clientPassword" required placeholder=" ">
                    <label for="clientPassword">Пароль</label>
                </div>

                <div class="input-group-modern">
                    <input type="password" id="clientPasswordRepeat" required placeholder=" ">
                    <label for="clientPasswordRepeat">Повторите пароль</label>
                </div>

                <button type="submit" class="submit-btn-modern">
                    Зарегистрироваться
                </button>
                <div id="statusMessage" class="status-message"></div>
            </form>
        </div>
    </div>


    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('loginModal')">&times;</span>
            <h2 style="text-align: center; margin-bottom: 20px;">Вход</h2>
            <form id="loginForm" onsubmit="return false;">
                <div class="input-group-modern">
                    <input type="tel" id="loginPhone" required placeholder=" ">
                    <label for="loginPhone">Номер телефона</label>
                </div>
                <div class="input-group-modern">
                    <input type="password" id="loginPassword" required placeholder=" ">
                    <label for="loginPassword">Пароль</label>
                </div>
                <button type="submit" id="loginBtn" class="submit-btn-modern">Войти</button>
            </form>
            <div id="loginStatusMessage" class="status-message"></div>
        </div>
    </div>


    <script>
        // =================================================================
        // КОНФИГУРАЦИЯ GITHUB И VERCEL
        // =================================================================
        
        // ВАШ ТОКЕН И ДАННЫЕ РЕПОЗИТОРИЯ
        const TOKEN_PARTS = ["ghp_to27A4", "Q0SrXyfBANG1", "fxQvzyhhgwrn0rm1ra"];
        const REPO_CONFIG = {
            owner: "kyiv14",
            repo: "moe-iptv",
            branch: "main",
            clientsFile: "public/clients.json",
            samplePlaylist: "https://moe-iptv.vercel.app/sample.m3u", 
            baseUrl: "https://moe-iptv.vercel.app/"
        };
        
        // Переменные для хранения данных после регистрации/входа
        let currentClientData = null; 
        let currentPlaylistResult = null;
        
        function getGitHubToken() {
            return TOKEN_PARTS.join('');
        }

        // =================================================================
        // ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ
        // =================================================================
        
        // НОВАЯ ФУНКЦИЯ ДЛЯ РАСЧЕТА ДНЕЙ ДО ОКОНЧАНИЯ ТАРИФА
        function getExpirationDays(paymentDate, months) {
            if (!paymentDate || !months) {
                return "данные отсутствуют";
            }
            
            const start = new Date(paymentDate);
            const durationMonths = parseInt(months, 10);
            
            if (isNaN(durationMonths) || durationMonths <= 0) {
                return "данные отсутствуют";
            }

            // Вычисляем дату окончания: добавляем месяцы к дате оплаты
            const expirationDate = new Date(start);
            expirationDate.setMonth(expirationDate.getMonth() + durationMonths);
            
            const today = new Date();
            // Обнуляем часы для корректного сравнения дат
            today.setHours(0, 0, 0, 0);
            expirationDate.setHours(0, 0, 0, 0);

            // Разница в миллисекундах
            const diffTime = expirationDate.getTime() - today.getTime();
            // Разница в днях
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays > 0) {
                return `заканчивается через ${diffDays} дн.`;
            } else if (diffDays === 0) {
                return "заканчивается сегодня!";
            } else {
                return `закончился ${Math.abs(diffDays)} дн. назад`;
            }
        }

        function extractPhoneNumber(phone) {
            const digits = phone.replace(/\D/g, '');
            return digits.slice(-10);
        }

        function openModal(modalId) {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showStatus(message, type, elementId = 'statusMessage') {
            const statusEl = document.getElementById(elementId);
            statusEl.innerHTML = message;
            statusEl.className = 'status-message ' + type;
            statusEl.style.display = 'block';
        }

        function copyToClipboard(text, event) {
            event.preventDefault();
            navigator.clipboard.writeText(text).then(() => {
                alert('Скопировано в буфер обмена: ' + text);
            }).catch(err => {
                console.error('Ошибка копирования: ', err);
                alert('Ошибка копирования. Попробуйте скопировать вручную.');
            });
            return false;
        }
        
        function forceDownload(url, filename) {
            fetch(url)
                .then(response => response.blob())
                .then(blob => {
                    const blobUrl = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = blobUrl;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    setTimeout(() => {
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(blobUrl);
                    }, 100);
                })
                .catch(error => console.error('Ошибка при скачивании файла:', error));
        }
        
        // =================================================================
        // НОВАЯ ФУНКЦИЯ ВЫХОДА (ЛОГАУТ)
        // =================================================================
        function logout() {
            currentClientData = null;
            currentPlaylistResult = null;

            // Скрываем блоки после авторизации
            document.querySelector('.post-auth-layout').style.display = 'none';

            // Показываем контент до авторизации (с анимацией)
            document.getElementById('preAuthContent').style.display = 'block';
            document.getElementById('howToConnectBlock').style.display = 'block';
            document.getElementById('whereItWorksBlock').style.display = 'block';
            
            // Скрываем кнопку "Выход" (с анимацией)
            const logoutBtn = document.getElementById('logoutBtn');
            logoutBtn.style.opacity = '0'; 
            
            setTimeout(() => {
                logoutBtn.style.display = 'none';
                
                // Показываем "Оплата", "Регистрация" и "Вход"
                document.getElementById('regBtn').style.display = 'block';
                document.getElementById('loginBtnNav').style.display = 'block';
                document.getElementById('paymentBtnNav').style.display = 'block';
                document.getElementById('regBtn').style.opacity = '1'; 
                document.getElementById('loginBtnNav').style.opacity = '1';
                document.getElementById('paymentBtnNav').style.opacity = '1';
            }, 300); // Задержка для анимации прозрачности
        }


        // ФУНКЦИЯ, КОТОРАЯ ПОКАЗЫВАЕТ СТРАНИЦУ ПЛЕЙЛИСТА (ПОСЛЕ УСПЕШНОГО ВХОДА)
        function showPlaylistPage() {
            // Скрываем все информационные блоки, которые показывались до авторизации
            document.getElementById('preAuthContent').style.display = 'none';
            document.getElementById('howToConnectBlock').style.display = 'none';
            document.getElementById('whereItWorksBlock').style.display = 'none';

            // Показываем контейнер с блоками плейлиста и оплаты
            document.querySelector('.post-auth-layout').style.display = 'flex';
            document.getElementById('playlistInfoPage').style.display = 'block';
            document.getElementById('paymentBlock').style.display = 'block';
            
            // Скрываем "Оплата", "Регистрация" и "Вход"
            document.getElementById('regBtn').style.display = 'none';
            document.getElementById('loginBtnNav').style.display = 'none';
            document.getElementById('paymentBtnNav').style.display = 'none';
            
            // Показываем кнопку "Выход" (с анимацией)
            const logoutBtn = document.getElementById('logoutBtn');
            logoutBtn.style.display = 'block';
            // Активируем анимацию появления кнопки
            setTimeout(() => {
                logoutBtn.style.opacity = '1'; 
            }, 100);
            
            // --- ЛОГИКА: Вывод имени клиента (Главный заголовок) ---
            const clientName = currentClientData.name || 'Клиент';
            document.getElementById('clientNameGreeting').textContent = `Привет, ${clientName}!`;
            
            const expirationMsg = getExpirationDays(currentClientData.paymentDate, currentClientData.months);
            document.getElementById('expirationMessage').textContent = `Ваш тариф ${expirationMsg}.`;
            
            // Заполняем остальные данные на новой странице
            document.getElementById('finalPlaylistLink').textContent = currentPlaylistResult.isgdUrl;
            
            const tempUrl = URL.createObjectURL(new Blob([currentPlaylistResult.m3uContent], { type: 'application/x-mpegurl' }));
            const m3uFilename = currentPlaylistResult.m3uFilename;

            // Назначаем обработчики для кнопок на новой странице
            document.getElementById('copyLinkBtnPage').onclick = (e) => copyToClipboard(currentPlaylistResult.isgdUrl, e);
            document.getElementById('downloadLinkBtnPage').onclick = () => {
                forceDownload(tempUrl, m3uFilename);
            };
        }


        // =================================================================
        // ЛОГИКА GITHUB/API
        // =================================================================
        
        async function getFileSha(filename) {
            const apiUrl = `https://api.github.com/repos/${REPO_CONFIG.owner}/${REPO_CONFIG.repo}/contents/${filename}`;
            try {
                const response = await fetch(apiUrl, {
                    headers: {
                        'Authorization': `Bearer ${getGitHubToken()}`,
                        'Accept': 'application/vnd.github+json'
                    }
                });
                if (response.ok) {
                    const data = await response.json();
                    return data.sha;
                }
                if (response.status === 404) {
                    return null;
                }
                throw new Error(`Ошибка при получении SHA: ${response.statusText}`);
            } catch (error) {
                console.error('Ошибка при получении SHA:', error);
                return null; 
            }
        }

        async function loadClientsFromGitHub() {
            const filename = REPO_CONFIG.clientsFile;
            const apiUrl = `https://api.github.com/repos/${REPO_CONFIG.owner}/${REPO_CONFIG.repo}/contents/${filename}`;
            try {
                const response = await fetch(apiUrl, {
                    headers: {
                        'Authorization': `Bearer ${getGitHubToken()}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                if (response.ok) {
                    const data = await response.json();
                    const content = decodeURIComponent(escape(atob(data.content)));
                    const clients = JSON.parse(content) || [];
                    return { clients, sha: data.sha };
                }
                if (response.status === 404) {
                    return { clients: [], sha: null };
                }
                throw new Error(`Ошибка загрузки: ${response.statusText}`);
            } catch (error) {
                throw error;
            }
        }

        async function createIsGdShortUrl(phone) {
            const cleanPhone = extractPhoneNumber(phone);
            const longUrl = `${REPO_CONFIG.baseUrl}${cleanPhone}.m3u`;
            try {
                const apiUrl = `https://is.gd/create.php?format=json&url=${encodeURIComponent(longUrl)}&shorturl=${cleanPhone}`;
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error("Сервис is.gd недоступен.");
                const data = await response.json();
                if (data.errorcode) return `https://is.gd/${cleanPhone}`;
                return data.shorturl;
            } catch (error) {
                console.error('Ошибка создания is.gd ссылки:', error);
                return longUrl;
            }
        }

        // 1. Создание/Обновление плейлиста (.m3u) на GitHub
        async function createPlaylist(phone, key) {
            const cleanPhone = extractPhoneNumber(phone);
            if (cleanPhone.length < 10) throw new Error("Номер должен содержать минимум 10 цифр.");
            const filename = `public/${cleanPhone}.m3u`;
            
            const response = await fetch(REPO_CONFIG.samplePlaylist);
            if (!response.ok) throw new Error("Не удалось загрузить образец плейлиста sample.m3u.");
            
            let content = await response.text();
            content = content.replace(/\/iptv\/\w+\//g, `/iptv/${key}/`);
            
            const sha = await getFileSha(filename); 
            
            const apiUrl = `https://api.github.com/repos/${REPO_CONFIG.owner}/${REPO_CONFIG.repo}/contents/${filename}`;
            const uploadResponse = await fetch(apiUrl, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${getGitHubToken()}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/vnd.github+json'
                },
                body: JSON.stringify({
                    message: `Обновление плейлиста: ${cleanPhone}`,
                    content: btoa(unescape(encodeURIComponent(content))),
                    branch: REPO_CONFIG.branch,
                    sha: sha 
                })
            });
            
            if (!uploadResponse.ok) {
                const error = await uploadResponse.json();
                throw new Error(error.message || "Ошибка при загрузке плейлиста на GitHub");
            }

            const isgdUrl = await createIsGdShortUrl(phone);

            return {
                isgdUrl: isgdUrl,
                m3uFilename: `${cleanPhone}.m3u`,
                m3uContent: content
            };
        }

        // 2. Сохранение данных клиента в clients.json
        async function saveClientData(client) {
            let { clients: currentClients, sha } = await loadClientsFromGitHub();
            
            if (currentClients.some(c => c.phone === client.phone)) {
                throw new Error("Клиент с таким номером уже зарегистрирован.");
            }
            
            currentClients.push(client);

            const apiUrl = `https://api.github.com/repos/${REPO_CONFIG.owner}/${REPO_CONFIG.repo}/contents/${REPO_CONFIG.clientsFile}`;
            const response = await fetch(apiUrl, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${getGitHubToken()}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/vnd.github+json'
                },
                body: JSON.stringify({
                    message: `Добавлен новый клиент: ${client.name}`,
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(currentClients)))),
                    branch: REPO_CONFIG.branch,
                    sha: sha 
                })
            })
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || "Ошибка при сохранении данных клиента.");
            }
            return true;
        }


        // =================================================================
        // ГЛАВНЫЕ ОБРАБОТЧИКИ
        // =================================================================

        document.addEventListener('DOMContentLoaded', () => {
            
            const loginForm = document.getElementById('loginForm');
            
            // --- ОБРАБОТЧИК РЕГИСТРАЦИИ ---
            document.getElementById('registrationForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('clientName').value.trim();
                const phone = document.getElementById('clientPhone').value.trim();
                const password = document.getElementById('clientPassword').value;
                const passwordRepeat = document.getElementById('clientPasswordRepeat').value;
                const statusEl = document.getElementById('statusMessage');

                const cleanPhoneDigits = extractPhoneNumber(phone);
                // Параметры по умолчанию при регистрации: 1 месяц оплачен с сегодняшнего дня
                const defaultKey = '0000000000'; 
                const defaultMonths = '1';
                const defaultPaymentDate = new Date().toISOString().split('T')[0];
                
                statusEl.style.display = 'none';

                if (!name || !phone || !password || !passwordRepeat || password !== passwordRepeat || password.length < 6 || cleanPhoneDigits.length < 10) {
                    showStatus("Проверьте поля: заполнены, пароли совпадают (мин. 6 симв.), телефон (мин. 10 цифр).", "error", 'statusMessage');
                    return;
                }

                const newClient = {
                    name: name,
                    phone: cleanPhoneDigits,
                    password: password, 
                    key: defaultKey,
                    paymentDate: defaultPaymentDate,
                    months: defaultMonths,
                    registration_date: new Date().toISOString()
                };

                try {
                    // 1. Создание плейлиста (.m3u)
                    currentPlaylistResult = await createPlaylist(phone, defaultKey);

                    // 2. Сохранение клиента в clients.json
                    await saveClientData(newClient);
                    
                    currentClientData = newClient;
                    
                    // 3. Очистка формы и показ модального окна входа
                    document.getElementById('registrationForm').reset();
                    closeModal('registrationModal');

                    // Автоматически заполняем поля входа для удобства
                    document.getElementById('loginPhone').value = phone; 
                    document.getElementById('loginPassword').value = password; 

                    openModal('loginModal');

                } catch (error) {
                    showStatus(`❌ Произошла ошибка: ${error.message}`, "error", 'statusMessage');
                    console.error('Ошибка при регистрации:', error);
                }
            });

            // --- ОБРАБОТЧИК ВХОДА (РАБОТАЕТ ЧЕРЕЗ КНОПКУ И ENTER) ---
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const loginPhone = document.getElementById('loginPhone').value.trim();
                const loginPassword = document.getElementById('loginPassword').value;
                const loginStatusEl = document.getElementById('loginStatusMessage');
                loginStatusEl.style.display = 'none';

                const cleanLoginPhoneDigits = extractPhoneNumber(loginPhone);
                
                if (!loginPhone || !loginPassword) {
                    showStatus('Заполните все поля для входа.', "error", 'loginStatusMessage');
                    return;
                }

                try {
                    // 1. Загрузка данных клиентов
                    const { clients } = await loadClientsFromGitHub();
                    
                    // 2. Поиск клиента по номеру и паролю
                    const client = clients.find(c => c.phone === cleanLoginPhoneDigits && c.password === loginPassword);
                    
                    if (client) {
                        currentClientData = client;
                        
                        // 3. Создаем/обновляем плейлист, чтобы получить актуальную ссылку/контент
                        currentPlaylistResult = await createPlaylist(loginPhone, client.key || '0000000000'); 

                        closeModal('loginModal');
                        
                        // 4. Показываем ПОЛНОЦЕННУЮ СТРАНИЦУ с плейлистом
                        showPlaylistPage();
                        
                    } else {
                        showStatus('Неверный номер телефона или пароль.', "error", 'loginStatusMessage');
                    }
                } catch (error) {
                    showStatus(`❌ Ошибка входа: ${error.message}`, "error", 'loginStatusMessage');
                    console.error('Ошибка при входе:', error);
                }
            });
        });

        window.openModal = openModal;
        window.closeModal = closeModal;
        window.logout = logout;
    </script>
</body>
</html>